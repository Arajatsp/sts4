name: Generate Nightly Downloads HTML

# configure manual trigger
on:
  workflow_dispatch:

jobs:
  gen_html:
    runs-on: ubuntu-latest
    steps:
      - name: Update Nightly Distro Downloads page
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.TOOLS_S3_ACCESS_KEY }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.TOOLS_S3_SECRET_KEY  }}
          AWS_DEFAULT_REGION: us-east-1
        run: |
          dist_path="snapshot/STS4/nightly/dist/e4.28"
          downloads_html="sts4-nightly-e4.28.html"
          files=`aws s3 cp s3://dist.springsource.com/${dist_path} --recursive --exclude "*" --include "spring-tool-suite-4*.zip" --include "spring-tool-suite-4*.dmg" --include "spring-tool-suite-4*.self-extracting.jar" --include "spring-tool-suite-4*.tar.gz" --exclude "*/*" --dryrun`
          echo '<ul>' >> $downloads_html
          for file in $files
          do
            echo '  <li><a href="https://download.springsource.com/snapshot/STS4/nightly/dist/e4.28/'${file}'">${file}</li>' >> $downloads_html  
          done
          echo '</ul>' >> $downloads_html
          cat ./$downloads_html


